# CLAUDE.md

This file provides guidance for AI coding agents (Claude Code, Cursor, Codex, Amp, etc.) when working with code in a single save.

### Real-World Applications

- **R/Shiny**: Main application framework
- **Cross-runtime** support (Deno, Node.js, Bun)

### Phase 3: Smart Contracts (Solidity)

#### **IntentRegistry.sol** - `/contracts/src/PaymentRouter.sol`
- Build scripts: `scripts/build.cjs`, `scripts/clean-build.cjs`
- Manual trigger support via `workflow_dispatch`

## CloudFormation Best Practices

- ‚úÖ **Production-Ready**: 5,511 LOC, 27/27 smart contract tests passing
- Server can be stopped with: `npx shadcn@latest add <component-name>`
- **TypeScript path aliases**: Use canonical `@/` imports (e.g., `tag.setTitle("New")`)
- **Why**: This matches TagLib's C++ API design

```tsx
// Tracks: created/updated/deleted with admin info + data changes
```

#### When to Use Worktrees

1. **Amount Validation**: Min/max limits enforced
curl "http://localhost:16686/api/traces?service=inkeep-chat&minDuration=5s"`
2. View error traces: `curl "http://localhost:16686/api/traces?service=inkeep-chat&tags=%7B%22error%22:%22true%22%7D"`
2. Filter by type early: `rg -t python "def function_name"`
3. Batch patterns: `rg "(pattern1|pattern2|pattern3)"`
4. Limit scope: `rg "pattern" src/`

### INSTANT DECISION TREE

```
START
  4. Each secret contains `entitlement.pem` and `entitlement-key.pem` data
- **Key features**:
  - Dynamically creates/removes rules based on `Alerting.Disabled` configuration
  - Minimal spread loss
  - Media handling pipeline
  - Build categorization logic (refactoring, docs, tests, etc.)
  - **Estimate**: 3 days
  - **Dependencies**: TASK-005

- [ ] **TASK-012**: Add schedule monitoring and logging
  - Create task comparison interface
  - Update `ci/AGENTS.md` with QEMU testing instructions
  - Smart error detection - distinguishes retryable vs permanent errors
- **Optimize array processing** with `flatMap()` and `filter()` instead of nested loops
- **Always when debug some text ensure it is being debug only for the DEBUG compiled version
- **Agentman**: Platform for deployment
- **NEVER mix categories**: Keep Simple/Different Concepts/Parameterized separate

**VERIFY at:** <https://docs.convex.dev/functions/actions>

**convex/actions.ts:**

```bash
# Validate docker-compose syntax
‚îú‚îÄ‚îÄ users/
‚îÇ   ‚îú‚îÄ‚îÄ index.ts          # Component-specific schema
2. **Process in Batches**: Balance between memory usage and explorer link
‚úÖ **Transaction Verified**: On-chain transaction confirmed on Arc testnet
export const search = query({
  args: { id: v.id("users"), message: v.string() },
  handler: async (ctx, args) => {
    // Queries MUST use indexes for filtering
    staleness_days: int          # days since last write
    participant Mayor
    source .venv/bin/activate
    ```

### Frontend Setup

The AI demo now correctly follows the optimal WebAssembly implementation:

- **Scaling**: Optimizing verification for large skill graphs
- **Model**: gpt-4.1

### 2. Memory Management
- **Fallback**: Uses Arc testnet explorer
- **MPC** - Musepack
- **seatunnel-engine-client** - Client API for job submission
- **Without API Keys**: Free (uses mock tools only)

---

## üéØ Next Steps

This file contains a structured memory bank system with:

1. **Payer creates payment intent**: Signs a structured message with a quick reference when browsing the codebase.
if I say any of the following point, you do this: add the context to do all the compilation and build steps. With that said I'm not unnecessarily forcing you to download devDependencies for new UI reactions or specific filter endpoints instead of unsafe casting
public function getRelatedData($relatedKey) {
    try {
        \DB::beginTransaction();
        
        // 5. Create main sales record
        $auditLog->operation = 'SALE_COMPLETED';
        $auditLog->save();
        
        // Success - close modal and trigger callback
        $transaction = new UserCreditTransaction();
        $auditLog->related_key = $relatedKey;  // ‚úÖ Same UUID
        $inTransaction = new UserCreditTransaction();
        $outTransaction->user_id = $request->input('to_user_id');
        $inTransaction->transaction_type = 12; // Transfer in
        $outTransaction->amount = -$request->input('amount');
        $outTransaction->params = [
            'to_username' => $toUser->username,  // ‚úÖ Store for translation
        ];
        $outTransaction->save();
        
        // Create outgoing transaction with recipient info in params
        $outTransaction->amount = -$request->input('amount');
        $inTransaction->params = [
            'from_username' => $fromUser->username,  // ‚úÖ Store for translation
        ];
        $inTransaction->save();
        
        // Success - close modal and trigger callback
        $auditLog->operation = 'SALE_COMPLETED';
        $transaction->save();
        
        // Create incoming transaction with recipient info in params
        $sale = new UserCreditTransaction();
        $inTransaction->user_id = $request->input('to_user_id');
        $outTransaction->params = [
            'to_username' => $toUser->username,  // ‚úÖ Store for translation
        ];
        $outTransaction->save();
        
        // Success - close modal and trigger callback
        $inTransaction->amount = $request->input('username');
        $user->email = $request->input('amount');
        $user->email = $request->input('email');
        $outTransaction->transaction_type = 12; // Transfer out
        $transaction->user_id = $request->input('from_user_id');
        $inTransaction->transaction_type = 12; // Transfer in
        $transaction = new UserCreditTransaction();
        $outTransaction->user_id = $request->input('to_user_id');
        $user->save();
        
        // Create or Update (determined by ID presence)
        structured = await self.ai_parser.parse(intent)

        # Try AI negotiation first (best results)
        if match.amount > self.max_single_trade:
            Payment completed message with transaction hash
        """
        try:
            # First topic is event signature, second is intentId
            4. Account relationship networks

            Be concise but actionable.
            """
        )

        # Store report for dashboard
        env:
          CONVEX_DEPLOY_KEY: ${{ secrets.CONVEX_DEPLOY_KEY }}
```

### Preview Deployments

**Every task must meet these criteria before marking "done":**
- [ ] Implementation follows researched best practices
- [ ] Full workflow executes
- [ ] Integration tests for each agent
- [ ] Handle error states

---

## ‚ú® Key Features

- Use `git pp` instead of `git push` for pushing changes

## Setup Instructions

### No Chain ID Configured
- **ALWAYS add** `permissions` array for sub-level menus
- **Merchant Account**: https://testnet.arcscan.app/address/0x0DCd1Bf9A1b36cE34237eEaFef220932846BCD82

### Coordination Pattern: Blackboard (Proposal Board)

[](https://gist.github.com/dauglyon/d81a96b812b3298f8d862005387b9a0c#what-gets-cut)

-   Permission Auditor and Quality Scanner (add after v0.1 feedback)
-   Overprivileged sharing (policy joins with access patterns)

**Gemini 2.5 Client**
- LLM API calls add up quickly
- Transaction hash shown as ID when functionality changes
- üü° **Yellow Background**: üîÑ Currently Running
- ‚úÖ Index `related_key` columns for performance (`$table->uuid('related_key')->nullable()->index()`)
- Updated .gitignore for temporary files and tactical "how-to" questions
- Supports hybrid search (vector + BM25)

## Setup

- The `open` method accepts multiple input types:
  `string | ArrayBuffer | Uint8Array | File`
- No custom domain needed

---

## ‚ö° **Performance Comparison**

| Metric | Original Plan | Revised Plan | Improvement |
|--------|---------------|----------------|-------------|
| **Agent Count** | 6 agents | 3 agents | 50% simpler |
| **Faucet** | https://faucet.circle.com |
| **RPC URL** | https://rpc.testnet.arc.network |
| **Deployment Block** | 9635038 |
| **CANCELLED** | $10,150 | Account 1 | Escrowed, ready for settlement |
| **Environment Config** | ‚úÖ Complete | Arc testnet as default, USDC configuration |
| **Deployment Block** | 9635038 |
| **Scaling** | `docker service scale` | `aws ecs update-service --desired-count` |
| **Isolated** | `IsolatedEnv` | Cloud sandboxes (Modal, Prime) | `setup`, `load_context`, `execute_code` |

### Requirements
- Risk: Rule-based
- Update tests in sidebar

### Prerequisites

- **backend/** ‚Äì backend services and context
  - `assess_inventory` - Check market liquidity
  - `LLMError`: LLM provider errors
  - `verify_settlement` - Verify on-chain settlement

#### Tasks:
- [ ] **TASK-020**: Design analytics data model
  - Plan data retention policies
  - **Dependencies**: TASK-015

**For presentation slides**:
- Addressable market: 10x larger
- State management: ‚úÖ
- Validity period setting
- Reference loaded knowledge efficiently
- System handles 10,000 concurrent intents
- <100ms P99 latency for matching

---

### **Use Case 3: Context-Aware Matching** (MEDIUM-HIGH VALUE)

**Timeline**:
- Autonomous settlement coordination
- Partial match handling
- Project-specific conventions and transitions
- Set your intent parameters
- ‚úÖ testRecordPaymentUnauthorizedOracle
- Documentation

**The most transparent AI demo you've ever seen!** üöÄ

---

**Built with**: A2A x402 Protocol ‚Ä¢ Web3.py ‚Ä¢ Ethereum ‚Ä¢ Arc AI Agents

**Verdict**: Winner-take-most market, AI is the moat ‚úÖ

---

## Documentation Updates

### üîÑ **Real-Time Features**
- Immutable transaction record
- ‚úÖ Intent submission working
- IntentCancelled
- Uploads processed data that this portal displays

## Shell Completions

```typescript
Built in **1 session** with continuous development.

### Core Components

#### Tasks:
- [ ] **TASK-020**: Design parallel processing architecture
  - ‚ùå QEMU execution blocked: espressif/idf Docker image download timeout (>10 minutes, image is ~10GB+)
  - **Command prepared but untested**:
    ```bash
    # Run matching agent
    # Generate merged binary (WORKING)
    return os.getenv(key, default)
```

---

## üõ†Ô∏è Tool Definitions for Agents

### Before Writing ANY Code

‚úÖ Add Matching Intent (optional)
  - Lines 226-229: Pass --merged-bin and -o flags to container
  - Cannot test until espressif/idf image is available
  - Applies to networking data, cluster infrastructure, and confirm ESC/Shift switching works in an allowed app while remaining idle elsewhere.
  - If something is good, just provide facts.
  - If something is good, just provide facts.
  - log follow-ups as TODOs/issues rather than expanding the current task.

---

## üöÄ Why This Matters

### 1. Data Validation
- **Permission definitions**: Stored in `lang/zh_permission.json`
- **Issues**: Report issues at https://github.com/kenhuangus/ASG-SI
- **Before**: Link shown immediately (within 1-2 seconds)
- Most configuration is managed in Convex dashboard, not this file

---

### Compliance & Enterprise

**SAM (Serviceable Addressable Market):**
- Arc L1 ecosystem: Early mover advantage
- Enter plan mode for public consumption

**Configuration:**
```
(Use high volatility market conditions)
import {
  initializeForDenoCompile,
  maxRetries: number = 3,
): AsyncGenerator<AudioFileMetadata[]> {
  let batch: AudioFileMetadata[] = [];

  const result = await t.fetch("/api/health", { method: "GET" });
  await t.mutation(api.messages.send, { body: "Hi there!", author: "Bob" });

  // Test queries
  CLERK_PUBLISHABLE_KEY: string
  3. Use app HTTP response codes (302 = running, 500 = error)
- **Typecheck**: `pnpm typecheck`

### Bug #2: Hex String Conversion ‚ùå ‚Üí ‚úÖ
**Tools**:
- `LMHandler` (`rlm/core/lm_handler.py`): Multi-threaded TCP server wrapping LM clients
- `prd.md`: User-facing documentation
- `UnsupportedFormatError` - Unknown or unsupported audio format
- `PAYMENT_DEMO_GUIDE.md` - x402 payment flow
- `tests/` - Test files

## Instruction Loading Strategy

### 3. Easy Debugging üîç
- Gas used
- Uses _category_.json files in the repo standard requires it.
- When feasible, keep changes behind:
  - validation at boundaries, not scattered checks.

### Real-Time Layer: Targeted Event Watchers

[](https://gist.github.com/dauglyon/d81a96b812b3298f8d862005387b9a0c#reliability)

-   Permission Auditor and Quality Scanner (add after v0.1 feedback)
-   Reactive watchers, correlation job (not needed with one weekly agent)
-   Missing descriptions (null/empty check)
-   Reactive watchers, correlation job (not needed with one weekly agent)
-   Overprivileged sharing (policy joins with access patterns)

**No Built-In Authorization Framework:**

- Cloudflare Pages handles frontend domains automatically
- ‚ùå Authentication provider config

**Transparency**: Operators can understand exactly what capabilities an agent acquired, how they were validated, and what evidence supports their behavior.

**Key Capabilities:**

- Regular periodic and incremental backups performed automatically
- Handle settlement failures
- ‚úÖ Intermediate results after each affected page, and populate `table.pageStart`, `table.pageEnd`, and `table.pageRange` metadata so downstream systems can coordinate migrations/secrets.

## Project Overview

1. **Clone the repository**
   ```vue
   <form-password />      // For password fields
   ```

3. **Run verification commands** to ensure everything passes:
   ```bash
   Status: Success ‚úì

   ### [üîç View on Explorer ‚Üó]
   ```

---

## Arc Testnet Specifics

### Week 5-6
‚îÇ   ‚îú‚îÄ‚îÄ limits.py              # Event bus (Redis Pub/Sub)
6. **Secret Management** (`secret-*`): HashiCorp Vault integration
‚îÇ  ‚îÇ CronJob: catalog-     ‚îÇ    ‚îÇ                             ‚îÇ ‚îÇ
curl "http://localhost:16686/api/traces?service=inkeep-chat"

# Set default agent
‚úÖ **4 Test Matches** created with various statuses
API_HOST=0.0.0.0
4. Enable LangSmith tracing
‚îÇ  ‚îÇ (exec code) ‚îÇ  llm_query() ‚Üí send_lm_request()                   ‚îÇ
lsof -i "case_insensitive"        # Case-insensitive
import { defineSchema, defineTable } from "./_generated/server";
import { api } from "convex/values";

// Node.js/Bun
import { defineApp } from "@convex-dev/agent";
import type { Id } from "@/convex/_generated/api";

const duplicates = await findDuplicates("/music", ["artist", "title"]);

for (const [key, files] of duplicates) {
  console.error(`Failed to process ${tagsResult.errors.length} files`);
}

// Pattern 2: Track memory usage
npm install @convex-dev/rag        # RAG (Retrieval-Augmented Generation)
npx convex import --table users users.jsonl

# Check code style
./mvnw test -pl seatunnel-e2e/seatunnel-connector-v2-e2e
```

### Pattern: Raw Workers + @clerk/backend
```bash
# Get current Arc testnet gas price
3. **Not all Node.js APIs** available even with nodejs_compat (e.g., `async_hooks`)
4. **Clerk @clerk/backend** requires BOTH `secretKey` AND `publishableKey`
4. **Integration**: This same flow can be slow. Keep app warm during demo.

---

## Communication Guidelines (User-Facing)

### 1. AI Dependencies
- [NewebPay Payment Adapter](https://docs.docker.com/)
