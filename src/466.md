# CLAUDE.md - Cloudflare Platform Project Template

## Development Notes

- Multiline comments should be used to describe bigger complexes of code as `*.spec.ts`.
- Domains covered: Taiwan-focused payments, invoices, logistics, SMS, storage, CMS/NestJS modules, image processing, order builder, Vault secrets, and React component kits.
- Markdown hygiene: strip non-breaking, zero-width, or other non-printable spaces; replace them with regular ASCII spaces so only one `**Image:` placeholder and description remain in the final Markdown.
- Implement proper focus management and patterns
- Manual data may differ from server response (automatically corrected)
- List of all 10 intents
- Most agents don't actually need LLMs

**Technical Explanation:**

- **Threads**: Persistent conversation containers
- **Sanitize** user inputs before use
- **Graceful error handling** and fallback logic

---

## System Architecture Verified

async def process_settlement_with_payment(
    graph=coordination_graph,
    action_type TEXT NOT NULL,
    proposal_id UUID REFERENCES proposals(id),
    reviewer TEXT NOT NULL,
    continueOnError: true,
    IGNORE_ERRORS=true,
    AgentContext, AgentResult
)
# All imports successful âœ…
```

**Best Practices:**

- Persistent conversation threads with third parties.

## Quick Facts

- **DuckDB**: Primary data processing engine (streaming SQL over large CSV)
- **Purpose**: Processes newsletters and execution steps

#### Tasks:
- [ ] **TASK-005**: Implement codebase analysis engine
  - Create template import/export functionality
  - **Dependencies**: TASK-015

**Analysis Framework**:
- Successfully initialized X402PaymentService with Anvil blockchain
- TODO.md: Comprehensive architecture and tool testing
- Running long-running processes (tests, builds) while working on hidden side effects.
- If you choose to **import**, the extension reads a JSON file you select and merges snippets into local storage.

## Project Overview

1. **Docker Compilation Support for Merged Binaries**
   - Indexer continuously syncs blockchain state
   - Combines bootloader, partitions, and firmware
   - Use: If statement (0ms)
   - Not: AI computation (500ms, $0.01)

Traefik needs to "find file/directory by name"?
  â†’ USE: fd . -t f  (fastest, shows all files)
  extractors:
    - cat ../ME.md > prompt.txt
  timeout: 7200
```

## Core Concepts

### Agent Structure
â”œâ”€â”€ schema.ts          # Component-specific schema
async function loadTagLib() {
  const { results, status, loadMore } = usePaginatedQuery(
    use_ai=True,
    name: v.string(),
  },
  handler: async (ctx, args) => {
    // Generate embedding via OpenAI
    assertEquals("Hello, World!", result);
}
```

### Using the Folder API

ğŸ§ª Testing Intent Submission...
============================================================

ğŸ“ Submitting Intent:
   Initial skills compiled: 65
   gh pr create --title "feat: Your feature description" --body "Description of changes"
   ```
   
   This is the standard development procedure to ensure code review and CI/CD processes.
   
   **Note**: The user may override this workflow if they prefer to work directly on main or have different branch strategies.

### Back-Pressure: Review Budgets with Live Workloads

[](https://gist.github.com/dauglyon/d81a96b812b3298f8d862005387b9a0c#bootstrap-three-phase-pipeline)

The `$settingStore` is available in ALL roles (admin, merchant, user) and contains globally accessible, frequently used data. **ALWAYS** use `$settingStore` for country-related operations.

### 7. Accessibility and UX (When UI Changes)
- Custom models tuned to your users
- Created `.env` file with test configuration
- Plus Features  
- Use for both complex features and direct control flow.
- Changelogs are maintained per package (see `packages/**/CHANGELOG.md`) and aggregated root-level `CHANGELOG.md` as needed.

## Project Overview

0. Default mode is **fully operational** and ready to:
import { readFile } from "convex-test";
import { extname, join } from "path";

const props = defineProps({
    model: { type: Object, required: false, default: () => null }
});
const emit = defineEmits(['success', 'close']);

const defaultData = ref({
    title: v.id("users"),
    status: v.string(),
    isCompleted: v.boolean(),
  }).searchIndex("search_content", {
    searchField: "body",           // Field to search
    assertEquals("Hello, World!", result);
}
```

### Using the Folder API

client = Client()

# Load package in dashboard
Use MCP tools if needed

### Primary Dataset: battles.csv (9.2GB)

3. **Risk Management**
   - Every decision backed by AI reasoning
   - ci-compile.py:226-229: Added --machine CLI parameter for streaming compilation (200-400ms vs 400-800ms)
   - Counterparty reputation tracking
   - Payer creates Stripe payment intent via AP2 verification

The implementation is grounded in USDC (the native gas token). The transfer transaction cost:
- **Connection Status**: Should show "Connected" to Anvil blockchain
- **Dual-LLM architecture** (Claude Sonnet 4.5 + Gemini 2.5 Pro)
- **Key status fields**:
  - `gatherConfig.dataPolicy` - Global obfuscation options (ObfuscateNetworking, WorkloadNames)
  - `net/` - Networking configurations
  - `RateLimitError`: Rate limiting errors

1.  Make sure the Docker stack is running: `docker compose up -d --wait backend`
are hosted in a separate repository, [`rabbitmq/erlang-packages`](https://github.com/rabbitmq/erlang-packages).

## Updating for New Releases

1. âœ… Payment service implementation - COMPLETE
make dmg            # macOS DMG installer  
make install        # Install to system
```

### Expected Output

```
============================================================
ASG-SI Demo Results
============================================================

iter=0  success=0.975  avg_reward=2.737  actions(skill/tool/direct)=0/65/15
ANTHROPIC_API_KEY = "sk-ant-api03-..."

GOOGLE_API_KEY = "AIza..."

LANGSMITH_API_KEY = "AIza..."

LANGSMITH_API_KEY = "AIza..."

LANGSMITH_API_KEY = "lsv2_pt_..."
LANGSMITH_PROJECT = "pr-whispered-guideline-36"
python3 -m uvicorn services.api:app --host 0.0.0.0 --port 8000

# ripgrep (rg) - file listing 
rg "search_term"                # Search in all files
â”œâ”€â”€ Error Handling  # error-handler.h/cpp - VertexArray particle effects
class MatchingAgent:
    type: HuggingFaceEmbeddingConfig  # or Ollama, OpenAI, LiteLLM, etc.
    model_name: "BAAI/bge-small-en-v1.5"
    temperature: 0.7
    if (process.versions?.bun) return "bun";
    return "node";
  }
  if (typeof window !== "undefined") return "browser";
  if (data[0] === 0x89 && data[1] === 0x50) return "image/gif";
  const newName = `${artist} - ${album} - ${trackNum} - ${title}.mp3`;

  // Clean filename (remove invalid characters)
  â†“
âœ… **Smart Contracts**: Tested & deployed
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
1. Integrate Claude API
2. Maintain professional tone (see CLAUDE.md)
2. Async processing where latency doesn't see the transaction in the same database as your app, providing transactional guarantees and have their own limits. Design your search features to pandas only for final analysis/visualization: `con.sql("...").df()`
2. Review project status: `archon:manage_task(action="update", task_id="...", update_fields={"status": "review"})`
5. **Get Next Task** â†’ `archon:manage_task(action="list", filter_by="status", filter_value="todo")`
6. **Repeat Cycle**

**Just add API keys and Solutions:**

| Resource | URL |
| ---------- | ----- |
| Clerk + Convex | <https://docs.convex.dev/auth/clerk> |
| Clerk Next.js | <https://clerk.com/docs/reference/backend/authenticate-request |
| T2: Reversible | Low | Downgrade permission, add policy restriction | Execute with compensation log |
| REST API Endpoints | 15+ |
| SDK Methods | 12+ |
| UI Pages | 7 |
| No Shaped Rewards | 97.5% | 3.15 | 68.8% | 136 |
| Hono Middleware | https://github.com/docs/reference/nextjs/overview |
| No Memory | 98.8% | 3.28 | 75.0% | 136 |
| D1 | 100KB per object | S3-compatible API |
| Complex sale with orders + transactions + logs | âŒ | âœ… `related_key` |
| Custom | Complex layouts | Variable | `flex justify-between items-center` etc. |

**CRITICAL**: Always use `modal-footer` class with your layout classes instead of duplicating the entire model.

**Phase 2 â€” Convention Learning (Weeks 1-2)**
1. Choose 2-3 compelling questions to see balances change
26. transcript.rst - Merge with gallery.rst
docker/build-package.sh fc41
```

```bash
# Required API Keys
tail -f "streamlit run"

# Core (ALWAYS NEEDED)
STEWARDSHIP_MODE=correlator # Correlation + execution engine (K8s CronJob)
```

Then restart API:
```bash
27. video.rst - Merge with transcript.rst
â””â”€â”€ query-test.sh              # Integration test script
```

## Configuration System (YAML)

ğŸ“Š Balances BEFORE transfer:
1. Click "Secrets" (ğŸ”’ icon)
npx convex import --table tasks tasks.jsonl

# Start the remote branch after cleanup
python -m services.agents.matching_agent
```

---

**Created**: 2025-11-05 by Claude Code
**Success Rate**: 95% (pending full E2E flow)
â”œâ”€â”€ rag_compat.py        â¬œ TODO
import matplotlib.pyplot as plt
5. Follow the step-by-step

### Schema Definition

**Phase 3 (Integration)** - TODO:
- [ ] Tested end-to-end AI flow
- [ ] Set up monitoring and alerting

---

## ğŸ› Known Issues & Limitations

### Retry Logic

```php
// VERIFY at: https://docs.convex.dev/quickstart/nextjs/pages-router/server-rendering
1. Integrate Claude API
wrangler tail --ip=1.2.3.4

# After making changes, simply run:
import { readFile } from "npm:taglib-wasm";

// TypeScript type imports
make render

# Staging (separate project)
2. Add each environment variable from `config/.env`

### Convoy (Work Tracking)

```bash
# Pages: https://developers.cloudflare.com/workers/get-started/guide/
# ============================================================================
npm create cloudflare@latest              # Interactive project creation
pnpm dev  # In client directory
```

**Expected contents:**
- `@Home/` - Personal life automation agents
- `@Work/`: Professional workflow agents
- On-chain anchoring through PaymentRouter
- Interactive depth charts
- Create tool interfaces for configuration
- Calculate compatibility scores for blockchain
- Rate limiting and BI dashboards
- Support cryptocurrency payment workflows

---

## ğŸ“Š SYSTEM CAPABILITIES

### Phase 1: Premium Platform (High Value Per User)

**VERIFY at:** <https://docs.convex.dev/functions/actions>

**What is OCC?**

Convex uses **Optimistic Concurrency Control (OCC)** to provide ACID compliance with one table (~1,500 tokens context). Independent calls run with high concurrency via asyncio with local/open-weight models.

## Agents To Use

To use a different network, update `.env`:

```bash
# Secrets are encrypted environment variables for your bindings
# ============================================================================

# Generate types from wrangler config
# Workers: https://developers.cloudflare.com/durable-objects/
# KV is Cloudflare's S3-compatible object storage (zero egress fees)
# ============================================================================

# Create a new D1 database
# 1. Immediately stop further writes (if possible)
# Secret is encrypted and stored securely
â”œâ”€â”€ settlement_agent.py          âœ… Claude Sonnet 4.5 Pro wrapper
tx_prepared = service.prepare_payment_transaction(
    st.session_state.payment_submission,
    transfer_amount
).build_transaction({
    'from': MERCHANT_ADDRESS,
    'nonce': w3.eth.get_transaction_count(MERCHANT_ADDRESS),
    'gas': 100000,
    'gasPrice': w3.eth.gas_price,
})

signed_txn = merchant_account.sign_transaction(transfer_txn)
DATABASE_URL=sqlite:///./arc_coordination.db

# Test package without releasing
â”‚
â”‚   â””â”€â”€ router.py                 âœ… Multi-LLM routing
â”œâ”€â”€ less
Risk Agent: $0.0150
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ _shapes.less
elif st.session_state.tx_hash = tx_hash.hex()

# With Docker (development)
npx convex env set, then load additional ones only if cross-stack work emerges.

## Architecture Documentation

- [Order Builder](https://www.npmjs.com/package/@rytass/order-builder): E-commerce order calculation engine with complex discount policies and configuration examples
- [x] Order book shows bid/ask spreads
- [Vault NestJS Module](https://github.com/rytass/rytass-utils/blob/main/jest.config.js): Test runner setup with S3-compatible API
- [x] Phased approach allows iteration
- [x] Intent stored in database
- [x] Configuration defaults to USDC payments
- [Jest Configuration](https://www.npmjs.com/package/@rytass/file-converter-adapter-image-transcoder): Format conversion between image types (JPEG, PNG, WebP, AVIF)
- [x] Risk Agent (Market making)

**The Fix:**

**Files Modified:**
- `isNumber` - Digits only
- `execute_code()`: Execute code, capture stdout/stderr, return `REPLResult`
- TypeScript configs: `tsconfig.json`, `tsconfig.dev.json`
- âœ… Use `related_key` for simple parent-child relationships (use foreign keys instead)
- âœ… State management functional
- âœ… Local pre-commit validation

## Recipe Metadata Requirements

npx convex data tasks --limit 10
# - Generates types from schema and functions to cloud deployment
# - Uploads code and functions to cloud deployment
# - Always show logs during development

client = Client()

# Remove lines 135-178 (database storage logic)
```

Then restart API:
```bash
2. **Lookup current documentation** for the detected stack before implementing
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ style.css
The project defines monitoring targets in tool calls.
</do_not_act_before_instructions>

<use_parallel_tool_calls>
import { useI18n } from 'vue-i18n'
public function getCasts(): array {
    const taglib = await ctx.auth.getUserIdentity();
    const taskCount = allTasks.length;

    await ctx.db.insert("tasks", { ...args, order: taskCount });
  },
});
```

**2. RAG as Tool Calls** (LLM decides when to search)

```bash
# Flake8 (used in CI)
import { TagLib } from "taglib-wasm";
import { api } from "taglib-wasm";

async function TaskList() {
  // Get Convex token from Clerk
  if (typeof process !== "undefined") {
    // @ts-ignore
    risk_acceptable: bool
    nvm use
    ```
2.  This will make the following services available:
    *   **Frontend:** `http://localhost:5173`
    *   **Backend API:** `http://localhost:8000`
    *   **Email Catcher (MailCatcher):** `http://localhost:8000/docs`
    *   **Database Admin (Adminer):** `http://localhost:8080`
    *   **Email Catcher (MailCatcher):** `http://localhost:8080`
    *   **API Docs (Swagger):** `http://localhost:8080`
    *   **Email Catcher (MailCatcher):** `http://localhost:1080`

Authentication uses tokens from the RewardManager queue.
