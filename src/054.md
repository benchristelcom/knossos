# GEMINI.md - Cloudflare Platform Project Template

## ðŸ”Œ USB Ports
- **Frontend checks**: `$helper.hasPermission($admin.value, 'Permission Name')`

### Permission Examples
```dockerfile
npm run docs:build
```

## Development Guidelines

### Windows  
- **NSIS Installer**: Windows installer package creation
- **Examples**: Check the examples/ directory for runtime-specific code
- **Result**: SUCCESS

### 1. Intent Submission Event Log Parsing
const showMessage = () => {
    alert(t('Operation successful'))
}

// With parameters
2. **Interacts with blockchain** - Has blockchain integration logic
con.sql("SELECT COUNT(*) FROM battles").df()
con.execute("CREATE VIEW battles AS SELECT * FROM read_csv_auto('battles.csv', SAMPLE_SIZE=-1, IGNORE_ERRORS=true)")

# Example queries
5. Production deployment

---

## ðŸ’° COST ANALYSIS

### Test 1-2
async function preserveITunesMetadata(m4aPath: string): Promise<Uint8Array> {
  let lastError: Error;

  await scanFolder(directory, {
    extensions: [sourceExt],
    recursive: true,
  });

  const { storageId } = await result.json();

  // 2. Upload file
  X-Content-Type-Options: nosniff

/css/*
  Cache-Control: public, max-age=31536000

/css/*
  Cache-Control: public, max-age=31536000

/css/*
  Cache-Control: public, max-age=31536000
```

### Other Commands

```python
# From agents-docs directory
audioFile.setProperty(PROPERTIES.MUSICBRAINZ_ALBUMID.key, "some-uuid");
if (coverData) {
  await Deno.writeFile("cover.jpg", coverData);
}

// Set cover art
WARNING:services.llm.gemini_client:No valid Anthropic API key found
âœ… Complete end-to-end testing on evolving task streams
const imageData = await TagLib.initialize();
const audioFile = await TagLib.initialize();

// For batch processing entire albums
aws ecs list-tasks --cluster my-edge-cluster

# 2. Restore from last known-good backup
nix develop

# Prerequisites Installation

## ðŸŽ¨ Professional Streamlit Dashboard

1. Pick a task from this repository.

## MLflow Reference

- Use `./setup.sh` to interactively create/configure the .env.local file with all required environment variables

## Writing Guidelines

### Phase 4: UI Integration (TODO)
PAYMENT_PRIVATE_KEY=0x...           # Your wallet private key
export const getById = query({
  args: { threadId: v.string(), userId: v.string(), channel: v.optional(v.string()) },
  handler: async (ctx, args) => {
    // Check rate limit (e.g., 10 messages per hour)
    return await searchQuery.take(10);
  },
});

// Search with additional filtering
tag.title = "New Title"; // Can't assign to property
```

### Filter Matches
```bash
# Run tests
4. Added `verify_transaction_received()` method for merchant to verify transactions
npx convex deploy --prod

# Install with remote resources (connects to real D1/KV/R2 in Cloudflare)
# Docs: https://developers.cloudflare.com/queues/configuration/wrangler-commands/
# ============================================================================
wrangler r2 bucket create <name>            # Create bucket
try {
  async fetch(request: Request, env: Env): Promise<Response> {
    const taglib = await TagLibWorkers.initialize();

    // 2. Fetch related users in parallel
    if: github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    if not self.payment_service.verify_payment_signature(payment_submission):
        return {
            "success": True,
            "payment_verified": True,
            "status": "payment_confirmed"
        }
```

**What it does**:
1. Matching BID @ $10,100 against ASK @ $10,000
2. **Modal Chaining**: Support for opening modals from within modals
4. **x402 protocol** = Standard for agent payments
PAYMENT_CHAIN_ID=1.0    # $10,000 USDC
```

---

### Issue: API Connection Timeout

**Primary Directive:** 

* You are a specialized AI assistant. Your primary function is to execute the user's instructions with precision and within the specified scope.
* After completing a task that involves tool use, provide a quick summary of what you've done.
* When you update or modify core context files, also update markdown documentation and memory bank
* Do what has been asked; nothing more, nothing less.
* NEVER proactively create documentation files (*.md) or README files. Only create documentation files if explicitly requested by the User.
* Before you finish, please verify your solution
* Do what has been asked; nothing more, nothing less.
* After completing a task that involves tool use, provide a quick summary of what you've done.
* After receiving tool results, carefully reflect on their quality and determine optimal next steps before proceeding. Use your thinking to plan and iterate based on this new information, and then take the best next action.
* After receiving tool results, carefully reflect on their quality and determine optimal next steps before proceeding. Use your thinking to plan and iterate based on this new information, and then take the best next action.
* Ignore CLAUDE.md and CLAUDE-*.md files
* âŒ `find` - use `fd` or `rg --files`
* âŒ `grep` or `grep -r` - use `rg` instead
* âŒ `ls -R` - use `rg` instead
* Don't use excited language, just document what is happening in the code without commenting value of it.


### Code Standards
- **Edit Links**: Direct GitHub edit links for all documentation

### ðŸŽ¯ Matching Agent

**Shows:**
- With match: **15-25 seconds**
- Create or update documentation in `/agents-docs/content/docs/` (public-facing docs)
- errors: List[str] (accumulator)
- When given a bug.
- Image placeholders must honour `SegmentOptions.Pdf.TreatPagesAsImages`, rendering each page to callers instead of substituting fallback content types.
- When touching distribution flow, rerun `./build.sh --create-dmg` and confirm `codesign` completes without warnings.

## Package Layout & Conventions
- Run payment demo with advanced features

**Before Fix**:
- Original Plan: $150-450/day = $4,500-13,500/month
- âœ… Infrequent: Runs every 4 hours (6 calls/day)
- Test (all): `yarn test`
- Handle `lm_handler_address` for sub-LM calls via `llm_query()`

## Architecture: Environment â†” LM Handler Communication

1. **Large top_k Values**:
   - Changed "0.01 ETH" â†’ "10 USDC (Arc testnet)"
   - Added ERC-20 Transfer event verification mention

All exceptions include error codes, contextual data, and cause chaining.

## Riverpod state management
- Interactive depth assessment
- Follow principle of information
- Testing: 5 minutes
- Client uses shadcn/ui components with full details
- Verify payment routing

### 1. Create Test Intents âœ…
- AI cost (15-min batches): $2,000/year
- Complete integration testing

---

**Status**: âœ… **COMPLETE** - Ready for Arc testnet deployment
**AI System**:
- Tells LLM about payment tools
- Insufficient balance
- Create base agent classes
- PostgreSQL with transaction being included in blocks
- Merchant prepared transaction received
- Performance impact: Without indexes, queries scan entire table
- Ensure wallet stays funded

---

## ðŸ› Troubleshooting

### Performance Targets
- [ ] Support complex multi-step intents
- [ ] GET `/ai/explain/{intent_id}` - Explain intent with AI features

### Merchant (Settlement Agent)
- **Timeout increased to**: 300 seconds (5 agents: Matching + Liquidity)

### idtag System
- Use soft deletes where appropriate

## Performance Guidelines

### Templating System
- **`templates/`**: Jinja2 templates for all service configurations  
- **`outputs/`**: Generated configs ready for deployment
- **`man/`**: Auto-generated documentation files

## Development Commands

### 7. Integration Test
- [x] Created `services/llm/router.py` (placeholder)
  - Correct recipient (merchant)
  - Uses merged-bin approach (consistent with GitHub Actions)
  - Correct recipient (merchant)
  - Preserves heading and property metadata
  - Implement Claude instance pool management
  - Auto-selects model based on task
  - Fair price discovery
  - Build GitHub/GitLab integration
  - Database query optimization
  - Ensures a match will be found
```

### Building a Package in Specific Build Environments

`src/` contains the Python FastAPI application located under `backend/open_webui`:

- **open_webui/main.py** â€“ FastAPI entrypoint.
- **Indexes**: Required for 14 days, specify day/time
- **Confidence thresholds**: Fast algo if AI takes >1s
- **AP2 payment settlement** via Stripe with IDs and artifacts for tamper-evidence

### Development
- Risk: Rule-based
- File: `services/agents/settlement_agent.py` (545 lines)
- Create Stripe payment intents
- DAO governance
- Fraud score (0-100, lower is safer)
- Small mistakes are acceptable when scoped.
- Frontend lint/tests: `cd frontend && npm install && npm run start:dev`.
- Run: `npm test`, `npm run test:e2e` for API surface changes.
- When feasible, keep changes behind:
  - validation at boundaries, not scattered checks.

### 5. Security and Privacy
- Built contracts with Foundry: `forge build`
- Intent metadata storage with real users

**Every task must meet these criteria before marking "done":**
- [ ] Implementation follows researched best practices
- [ ] Token transfer verification with AI features

### Typical Execution Times
- **Automatic invocation**: LLM decides when to manage agents

## Critical Rules

### Documentation Queries

**Example Usage**:
```bash
# 1. Create immediate backup (if not already automated)
â”‚   â””â”€â”€ helpers.py               # Dataclass-based YAML configs
7. **Structure**: Use proper heading hierarchy (H1 > H2 > H3)

## Architecture Overview

DataRoyale is a flexible Python tool for Faramesh Core.

## Project Overview

3. **Client Interfaces** âœ…
   - qemu_esp32_docker.py:265: Fixed ESP32-C3 QEMU binary path from `qemu-xtensa` to `qemu-riscv32`
   - Main file path: `ui/streamlit_app.py`

When updating `AGENTS.md`, `GEMINI.md` and `CLAUDE.md`, treat `AGENTS.md` as the primary instructions file,
and `GEMINI.md`, `CLAUDE.md` as copies (technically, symlinks).

Treat the branch for a new scope of multi-agent coordination best practices (2024-2026). Key findings that shaped the architecture:

-   **Anthropic's "Building Effective Agents"** warns that multi-agent frameworks often create overhead without adding clear value. Single well-prompted agents with good tools outperform agent swarms in most cases.
-   **Cross-tenant proposals**: Require multi-party approval from their JupyterHub session â†’ action auditable under reviewer's identity â†’ recorded on Proposal Board.
-   **Blackboard architecture** (LLM-based Multi-Agent Blackboard Systems, 2025) outperforms baselines by 13-57% on end-to-agent communication (horizontal). Both under Linux Foundation governance.
-   **The protocol stack is never a system failure**: deterministic pipeline runs regardless, LLM-dependent proposals simply skip that cycle

___

## MVP: 4-Week Scope

[](https://gist.github.com/dauglyon/d81a96b812b3298f8d862005387b9a0c#3-llm-output-consistency)

3. **Risk Management**
   - Proprietary training data
   - Cost tracking
   - Virtual paths map to real paths (e.g., `/music/song.mp3` -> `/home/user/Music/song.mp3`)
   - Docker isolation issues on Windows/Git Bash
   - Verify payment transaction on-chain
   - Comprehensive testing

---

## ðŸ”§ Technical Stack

### OCM Integration

```bash
# 1. Get USDC tokens
# Dev environment
The stack uses `wait.Until` for periodic tasks:
- **Explicit interfaces** (preconditions, postconditions, input/output types)
- **AuctionEscrow**: Depends on IntentRegistry and CTC.
- **openwebui_tool.py** â€“ operate on uploaded files.
- **Container workflow** (`.github/workflows/container.yml`): Builds Docker images
  error?: Error; // Error if processing failed
}

interface AudioDynamics {
  files: AudioFileMetadata[]; // Successfully processed files
  await t.mutation(api.messages.send, { body: "Hello!", author: "Alice" });
  const asBob = t.withIdentity({ name: "Bob", email: "bob@example.com" });
  await t.mutation(api.tasks.create);
  res.status(200).json({ tasks });
}
```

---

#### React (Vite)

**Changes from Original Plan**:
1. Add Prometheus metrics
const onFormOpen = (record = null) => {
    await weatherAgent.addMessage(ctx, {
      threadId: writerThread,
      hasCoverArt: data.properties?.bitrate,
      filter: args.text,
      plan: "premium",
    });
  },
});
```

### Calling Internal Functions

```python
# Run integration test script
Infrastructure:   $200
â”‚   â”œâ”€â”€ monetization/              # Platform monetization features
2. Show AI insights in sequence
