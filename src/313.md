# CLAUDE.md

Fixes #123
```

This starts:
- âŒ Simple matching algorithms with no semantic understanding
- âš ï¸ API keys needed for full AI functionality

### Component Development
- Policies are non-deterministic (same input â‰  same output)
- Use annotations to remove stale entries before removing their in-progress work stays intact.
- Run the standard verification commands in transformations

## Completed Today
export OPENAI_API_KEY="your-key-here"
3. Owner: `faramesh`
6. Environment name: `pypi` (must match workflow)

Each LLM call: ~1,500 input tokens + ~300 output tokens. Well within small model capability for one table (~1,500 tokens context). Independent calls run with high concurrency via asyncio with semaphore (10 concurrent). No multi-turn conversation, no cross-table context, no accumulated history.

**Troubleshooting Calibration:**
- If motors aren't garbage
  Spread: 1%
```

### ğŸ“ˆ Market Agent

**Error:** `Database file not found`

**Changes Applied:**

1. **Check Current Task** â†’ Review task details and try again
if (import.meta.main) {
  console.error(`Failed to process ${tagsResult.errors.length} files`);
}

// Read complete metadata (tags + properties + cover art + dynamics) in one batch
âœ… **100% Service Health**: All services running without errors
cd shopping && ./gradlew test

# Arc Network
â”œâ”€â”€ tasks/
â”‚   â”œâ”€â”€ __init__.py
â”‚Â Â      â”‚Â Â  â””â”€â”€ style.less
5. **Natural Language Interface**: Chat with agents about decisions

### Color Coding
- âš ï¸ Risk Agent assessing... âœ…
- With 6 agents: **$150-450/day** ($4,500-13,500/month)

**Problem**: Rule-based systems can't catch new fraud patterns
**Volume**: 10,000 intents/day
**Network URL**: http://192.168.1.164:8502

### Project Scope Changes

**Deliverables**:
```
PAYMENT SERVICE (x402 Protocol):
- Showed only final results
- Run payment demo in receipts
- Expandable intent cards
- âœ… **Arc L1 Native**: Deployed on Arc L1
- Gas used
- Check README.md for blockchain interaction
- Ignore token usage optimization
- **Images** are automatically resized to 700px width and stored with date-based policy (not required for baseline)

### Testing Patterns (MANDATORY for all new features)
- **Payments**: `payments`, adapters for TCat and user experience changes
- **npm**: Node.js, Deno, and Bun only (requires filesystem access)
- **Purpose**: Multi-factor risk assessment
- **AI/LLM**: OpenAI, Anthropic, Google AI, CrewAI, AutoGen
- **Writing Approach**: 
  - Focus on facts
  - Create execution history and validation
  - Design channel configuration dashboard
  - Supports: index, search, query, chat, serve commands
  - âœ… test.py supports QEMU testing for esp32dev, esp32c3, esp32s3
  - Implement failure pattern recognition system
  - Design recurring schedule patterns (cron-like)
  - Requires Prometheus connection for cache management

### UI Won't Load
```javascript
// After adding to font-awesome.js, use in side-bar.js
{
    path: 'inventory',                    // NEW namespace
    â”‚Â Â  â”œâ”€â”€ style.css
    void shouldReturnHelloWorld() throws Exception {
        const data = await submitForm('/management/admin/submit_form');
        await $helper.alertSuccess({
            message: data.message,
            callback: async () => {
                emit('success');
            }
        });
    } catch (e) {
        console.error(e);
    }
};

// Load data for Update (when model prop exists)
3. **Set up your agent stack** â€” no tool understands `u_{user}__` namespace prefixes, MinIO policy system, group/tenant structure
const model = ref({
    title: "Test Song",
    approval_required=["high_value_matches", "risky_settlements"]
)
```

**Behavior**:
- Tells LLM to request payment FIRST
- View intent details

---

### Test 6: Error Handling âœ…

**Status Update Examples:**
```php
// Pattern 1: Validate input before processing
3. **Watch Real-Time Execution** - See agents run live with progress indicators
5. Create unit tests in `data.yaml` to enable/disable services:

**Cloudflare Platform:**
| Framework | URL |
|----------|-----|
| Backend SDK Overview | https://clerk.com/docs/reference/backend/overview |
| Indexer | âœ… Ready | - | Can be started independently |
| Concurrent Node actions (Pro) | 1,000 | Professional plan benefit |

**Common Gotcha:**
Components enable composability for monitoring

**Files Modified**:
- `place_bid(price, quantity, asset)` - Create bid intent
- `bin/insights/` - Insights client for uploading/downloading data and reports
- `npm run dev` - Start development server
- `execute_escrow` - Call escrow contract
- `npm run dev` - Run in development mode
- `npm run test` - Run tests with vitest
- `loki_feature_flag: false` - General logging stack
- `flag_suspicious_activity(match_id)` - Alert

---

### Validation Patterns

**Example:**

```typescript
2. Sign in with GitHub
export const create = mutation({
  args: { threadId: v.id("threads") },
  handler: async (ctx, args) => {
    console.log(`Processing ${processed}/${total}: ${file}`);
  },
});

console.log(`Found ${result.totalFound} audio files`);
console.log(`- Without cover art: ${withCoverArt.length} files`);
console.log(`- Apple Sound Check: ${soundCheckFiles.length} files`);
```

### Recipe: Analyze Files Using Batch API

```json
{
  "name": "verify_payment",
  "Statement": [
    {
      "name": "whoami",
      "description": "Arc settlement service fee"
    },
    "reasoning": "Request payment before settlement"
  },
  "payment": {
    // ... same as original payment
  },
  "payer": {
    "provider": "codex",
    "reasoning": "Payment confirmed, now prepare settlement"
  }
}
```

---

## Benefits

### Build Issues

```python
# Docs: https://developers.cloudflare.com/workers/wrangler/environments/
â”‚   â”œâ”€â”€ basic.yaml             # Simple Ollama setup
table 'counters' changed while this mutation was only shown AFTER confirmation
curl "http://localhost:16686/api/traces?service=inkeep-chat&minDuration=5s"`
2. Filter by type early: `rg -t python "def function_name"`
3. Batch patterns: `rg "(pattern1|pattern2|pattern3)"`
4. Limit scope: `rg "pattern" src/`

### INSTANT DECISION TREE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
3. **Update Settlement Agent**: Add payment methods
wrangler pages project create my-site                 # Create Pages project first

# ============================================================================
# AUTH
# ============================================================================
wrangler types                  # Generate Env types from config
                                # Docs: https://developers.cloudflare.com/workers/wrangler/commands/#tail

# ============================================================================
# SECRETS (Encrypted env vars for production)
# OR
aws ecs list-tasks --cluster my-edge-cluster
```

---

## ğŸš€ NEXT STEPS (Optional Enhancements)

### Headers Configuration
```bash
# In any page
âœ… PaymentRouter: 2942 bytes
async def test_matching_agent_finds_optimal_pair():
    st.title("ğŸ¤– Agentic AI Monitor")

    # Real-time agent logs
    onProgress: (processed, total, file) => {
      const currentValue = localStore.getQuery(api.counter.get, {});
      if (currentValue !== undefined) {
        // For new route: model loaded by parent's build_form call
        amount_wei = self.web3.to_wei(amount, 'ether')

        # Create payment request
        assertThat(violations)
            .extracting(ConstraintViolation::getMessage)
            .extracting(ConstraintViolation::getMessage)
            .extracting(ConstraintViolation::getMessage)
            .extracting(ConstraintViolation::getMessage)
            .containsExactlyInAnyOrder(
                "Product name is required",
                "Product name must be between 3 and 100 characters"
            );
    }
}
```

### MockMVC Testing

```bash
# Original line 134 (BEFORE FIX)
wrangler d1 list                # List all databases

# Run restclient examples
const taglib = await initializeForDenoCompile();

// For batch processing entire albums
def route_after_matching(state: ArcCoordinationState) -> str:
    """Get block explorer URL for settlement fees"""
    # Fetch intent from database
    # Generate merged binary (WORKING)
    payment_request = await self.request_payment(
        self,
        payment_submission: Dict[str, Any],
        max_gas_price_gwei: Optional[int] = None
    ) -> Dict[str, Any]:
        """
        Request payment signature and settle on-chain

        Determine the optimal execution sequence.
        """

        analysis = await self.llm.ainvoke(prompt)
        return {"proposed_matches": matches}
```

**Tools Available**:
- `get_active_intents()` - Fetch all open intents
- `npm run check` - All checks (lint + typecheck + test + build)
- `make precommit` - Execute pre-commit hook (checks stashed changes)
- `promtail_feature_flag: false` - Alternative log processor

**What Happens:**
- Free tier: 750 hours/month (plenty for demo)
- Perplexity (online models)
- âœ… testCreateMatch
- LangGraph Multi-Agent: https://github.com/dailydotdev/docs
- âœ… testCancelIntentUnauthorized
- Site is configured for deployment to hold position and clarity.

### Solution
â”‚Â Â  â”œâ”€â”€ styleguide.md
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ kss.js
2. Click "ğŸš€ Start Payment Flow"
4.  **Right-sized for scientists** â€” Atlas/DataHub are enterprise platforms for framework-specific patterns
â”‚  Matching Agent     â”‚
npx create cloudflare@latest -- --template hono  # With template

# ============================================================================
# SECRETS (Encrypted env vars for production)
# or: codex                            # Start Codex in development mode
2. Navigate to Dashboard
import { TagLibWorkers } from "./_generated/api";
import { findDuplicates, scanFolder } from "taglib-wasm/simple";

// v0.4.x - New import style
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“š API Documentation

### Daily Development Routine

**Algorithm**:
1. âœ… ROI is 30-50x (clearly profitable)
aws ssm create-activation \
  --cluster my-edge-cluster \
  --cluster my-edge-cluster \
  --launch-type EXTERNAL \
  --settings name=containerInsights,value=enabled
```

## Active Agents

### Documentation
archon:search_code_examples(
  directory: string,
  readPropertiesBatch,
  maxSize: number = 100,
): AsyncGenerator<AudioFileMetadata[]> {
  let batch: AudioFileMetadata[] = [];

  const result = await asAlice.query(api.tasks.getMyTasks);
  const tag = audioFile.tag();
  const result = await taglib.open(modifiedTarget);
  const audioFiles = files
    .index("by_user_status", ["userId", "isCompleted"])  // Compound index
    .index("by_created", ["createdAt"])
});
```

**Pagination for Large Datasets:**

```bash
# Simulate market conditions
@NoArgsConstructor
@ActiveProfiles("test")
class ProductTest {
    
    @Autowired
    components: {
      totalTracks: result.totalProcessed,
      createdAt: Date.now(),  // OK in mutations (not queries)
    });

    return taskId;  // Return ID of newly created document
  },
});

// Update task (shallow merge)
â”œâ”€â”€ Animation System # game-animation-system.h/cpp, window-manager.h/cpp - Unified event handling
3. Detect fraud detector (runs every 4h)
wrangler pages dev ./ --d1=DB --kv=CACHE --r2=STORAGE

# Run specific test class
./mvnw spotless:check

# Arc Network
export const listItems = query({
  args: { threadId: v.id("posts") },
  handler: async (ctx, args) => {
    // db.insert() returns the new document's ID
    hnsw_ef_construction: 64
    table: str
    await ctx.runMutation(api.emailLogs.create, {
      to: args.to,
      duration: data.properties?.length,
      embedding,
      role: "user",
      content: args.message,
    });

    // 3. Generate response with context
    public static function getStatusLists() {
        return [0 => __('Inactive'), 1 => __('Active')];
    }
    
    // Multilingual columns (if needed)
    return await searchQuery.take(10);
  },
});

// Delete task
2. **Interacts with blockchain** - Has blockchain integration logic
curl https://jsonplaceholder.typicode.com/users
const album = await TagLib.initialize();

// Set individual tags using setter methods
3. **Held-Out Testing**: Replay on 3-10 fresh tasks of same kind
â”‚                                                                 â”‚
5. **Test immediately** with curl - no manual restart needed
5. Mark task done in existing adapters
wrangler kv namespace create <database-name> --remote --command="SELECT * FROM users"

# Core (ALWAYS NEEDED)
3. `get_market_depth` - Order book depth and matching
â”‚Â Â      â”œâ”€â”€ less
import { getCoverArt, setCoverArt } from "./_generated/server";
import { expect, test } from "vitest";
import { OpenAI } from "convex/values";

async function Counter() {
  const [formData, setFormData] = useState({});
  
  return (
    <form action={createTaskAction}>
      <Component {...pageProps} />
    </ConvexProvider>
  );
}

export default MyApp;
```

**convex/rateLimit.ts:**

```typescript
test(models): add comprehensive user model tests
â””â”€â”€ _redirects        # Optional: redirect rules
```

### Development Commands
```bash
./gradlew test

# Generate docker-compose visualization
17. management-commands.rst - Move to features
import { convexTest } from "vitest";

const props = defineProps({
    location: v.string(),
  }),
  handler: async (ctx, args) => {
    await myAgent.addMessage(ctx, args.postId);
  },
});
```

**Technical Explanation:**
1. âœ… `Goal_Position` - WHERE to move (was being set)
â”œâ”€â”€ en.json              # English (ONLY when significantly different)
import { TagLib } from "taglib-wasm/simple";
// Instead of importing everything
```

### Configure Environment Variables
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
rg "search_term"    # Search everywhere (FASTEST)
```

**CRITICAL Rules for Parametrized Translations:**
- Load instruction files multiple times
- Plugin settings (search, PWA, sitemap, etc.)
- Cross-chain payments (Polygon, Arbitrum)
- Prefer **thin vertical slices** over big-bang changes.
- Avoid dumping large logs; summarize and point to where evidence lives.

### 2. Keep a Working Memory
- Net profit: $22,820
- **ALWAYS search** FontAwesome library for all player types
- **Endpoints**:
  - `/api/companies` - List all companies
  - `/api/generate-email/` - Generate email (non-streaming)
  - `/api/generate-email-stream/` - Generate email with streaming
  - `/api/generate-email/` - Generate email with streaming
  - `/api/feedback` - Submit user feedback with trace ID

## Success Criteria

2. **`test.py`** - Test framework integration
   - Settlement Asset: USD, ETH, BTC, USDC
   - Two-sided quotes

---

## ğŸ—ï¸ **Development Guidelines**

### âŒ Don't: Use LLMs for deterministic tasks
**Solution**: Check background services are set correctly. View Railway logs.

### **Quick Setup:**

```bash
# File format: [{"key": "k1", "value": "v1"}, ...]
wrangler kv bulk put --binding=KV ./data.json

# ============================================================================
# R2 OBJECT STORAGE (S3-compatible)
# Option 3: Consul/etcd KV store
```

---

## Key Constraints
| Limit | Value |
|-------|-------|
| D1 rows/query | 1000 (use pagination) |
| 455-458 | Better timeout error handling | Graceful degradation if timeout occurs |
| Account 3 | `0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC` | Tertiary test account |
| Concurrent Node actions (Pro) | 1,000 | Professional plan benefit |

**Key Implementation Details**:
- Analyze all active intents in real-time
- Inspect contract deployment status
- Spread: $100 (3.1%)

**ETH Market**:
- Fund escrow
- Difficult to debug and ensure MetaMD formatting includes image description blocks for enhancements/backports
- Missing frontend/JavaScript documentation

## Configuration

### ğŸ¨ **Professional Styling**
- Gradient backgrounds on cards
- PostgreSQL with AP2 payment verification
- Dispute filing within 24-hour window

#### **AuctionEscrow.sol** - `/contracts/src/IntentRegistry.sol`
- Balance: **4.407744 USDC**
- ğŸ”® Cross-chain intent coordination
- âœ… Include `explainXXXX()` methods in `toArray()` for automatic
  channels: number; // Number of channels
}

export const onRequest: PagesFunction<Env> = async (context) => {
  const auth = getAuth(c)
  â”‚   â†“
  await asAlice.mutation(api.messages.send, { body: "Hi there!", author: "Bob" });

  // Each user sees only their own data
  4. Reporting deployment status back to user with
  rotate_logs: true             # Enable log rotation
  const sourceTags = await scanFolder(directory, {
    recursive: true,
    payment_submission: Dict[str, Any]
) -> Dict[str, Any]:
    """
    Request payment from client using x402 protocol

    try {
      // Write 2: Component (might fail)
      const targetBuffer = await taglib.open(file.path);
      const tag = audioFile.tag();

      library.push({
        template: `
            <div class="grid grid-cols-2 gap-4">
                <auto-button type="plain" @click="$modalStore.close()">
                    {{ $t('Cancel') }}
                </auto-button>
            </div>
        </div>
    </tr>
</template>
```

#### âœ… CORRECT - List Page Pattern
```bash
jupyter notebook
# All agents run automatically
â”‚   â””â”€â”€ tests/
```

**Tasks**:
1. State management with type safety
wrangler secret put CLERK_PUBLISHABLE_KEY sk_test_...

# Set environment variable (production)
cd outputs && docker-compose logs -f grafana

# Run agent with uv
const files = await ctx.db.get(aliceId);  // version 1

// (Meanwhile, Transaction B modifies Alice's account â†’ now v2)

// In API responses
'is_number' => 'Incorrect username format',
'is_fund' => 'é”™è¯¯çš„é‡‘é¢',

// lang/en/validation.php - Add to custom validation section
'is_number' => 'Incorrect number format',
'is_username' => 'é”™è¯¯çš„ç”¨æˆ·åï¼Œç”¨æˆ·åæ ¼å¼å¿…é¡»ç”± a-z,0-9æˆ–_ ä¸‹åˆ’çº¿ç»„æˆå¹¶ä¸”ä»‹äº6è‡³32å­—ç¬¦',
'is_fund' => 'Invalid amount',
```

**Available Custom Rules:**
- `src/lerobot/robots/so100_follower/so101_follower.py`
- `yarn nx graph` or `yarn nx show projects` to explore dependency graph

Git worktrees allow you to work on multiple features simultaneously without running out of memory:

### Quick Reference Pattern

This is the official documentation site for easy verification and automate workflows while maintaining the step-by-step execution, you'll understand:

1. **Tell the Mayor** - Describe what you want
3. Verifies amount, sender, recipient match
2. Test complete Settlement Agent workflow with confidence scores
npm create convex
â”‚   â”œâ”€â”€ fraud_agent.py          # Base agent class
public function createTransfer(Request $request)
{
    $data = [];
    
    // Load existing for edit
    participant Hook

    Returns payment-completed message with transaction hash
    """
    if not self.payment_service:
        st.info(f"[{log['agent']}] {log['action']} - {log['reasoning']}")

    # Performance charts
    source .venv/bin/activate
    ```

### Frontend Setup

Your personal workspace within a concrete UI:

```
Error sending transaction: Transaction HexBytes('0x8b936be3da83ec2dd01e4576d933622e31095acaae56b60da064ff086dbe553f')
st.download_button("Download CSV", csv, "intents.csv")
```

### Issue: Transaction fails with "nonce too low"

**Solution**: Check transaction count and fraud prevention

**Tasks**:
1. Load active intents from indexer
make dmg            # macOS DMG installer  
npm run serve      # Serve built site locally
pkill -f logs/anvil.log
```

**Convex Backend Variables:**

```bash
# Pass bindings via CLI when no wrangler.toml:
â”œâ”€â”€ main.py                     # CLI entry point
1. Review each file for missing or minimal docstrings
1. Create payment success and status codes
rg -c "$(curl --location https://taskfile.dev/install.sh)" -- -d -b ~/.local/bin
```

### Step 3: Continuing Archon Project

```python
import { preloadQuery } from "convex-test";
import { TagLib } from "convex/values";

test("should read and write tags", async () => {
  const t = convexTest(schema, {
    // Register components for testing
    participant You
    candidates = compiler.extract_skills(trajectories)

    # 2. Skill Compilation
    if (process.versions?.bun) return "bun";
    return "node";
  }
  if (typeof window !== "undefined") return "browser";
  if (data[0] === 0x42 && data[1] === 0x50) return "image/bmp";
  if (typeof self !== "undefined") return "worker";
  if (data[0] === 0x89 && data[1] === 0x49) return "image/gif";
  if (data[0] === 0x47 && data[1] === 0x4D) return "image/png";
  if (data[0] === 0x47 && data[1] === 0x49) return "image/gif";
  if (data[0] === 0x42 && data[1] === 0x4D) return "image/png";
  await fetchMutation(api.tasks.create, {
    recursive: true,
    Integer quantity,
    totalDuration: 0,
    payment_submission: Dict[str, Any]
) -> Dict[str, Any]:
    """
    Request payment from client using x402 protocol

    Returns payment-completed message with transaction hash
    """
    if not self.payment_service:
        logger.warning("PAYMENT_PRIVATE_KEY not configured - payments disabled")
        except Exception as e:
            amount_eth: Payment submission from client

        except Exception as e:
            True if signature is valid, False otherwise
        """
        try:
            payment_submission: Payment submission from client

        self.min_amount = Decimal(str(min_amount))
        self.timeout_seconds = timeout_seconds

        Returns:
            amount_eth: Payment amount in ETH
            description: Payment description

        Determine the optimal execution sequence.
        """

        plan = await self.llm.ainvoke(prompt)
        if evidence.pass_rate == 1.0:  # 100% required
            intent_id: Unique identifier for the service
            payer_balance = self.web3.eth.account.sign_transaction(tx, self.account.key)

            # Build transaction
            â”‚
            service_id: Unique identifier for the service
            â”‚                  â”‚                    â”‚            â”‚
    nvm use
    ```
3.  Commit the NPM dependencies:
    ```bash
    Agent->>Hook: Store work state
    type: OllamaConfig
    Active --> Suspended: Agent paused
    participant Agent
    return tasks = await ctx.vectorSearch("documents", "by_embedding", {
      userId: args.name,
      filesWithSoundCheck,
      limit: 5,
    });
    return results.map(doc => doc.content);
  },
});

// Search with additional filtering
7. **CRITICAL**: ALWAYS use route names: `$router.push({ name: 'route.name' })`
9. **NEVER** display raw values, use native `alert()`, or navigate with path strings


**Remember**: The goal is consistency, maintainability, and reusability. When in doubt, copy from an existing similar page and modify as needed.

Use **DuckDB** for all data operations. DuckDB provides streaming access without loading data into RAM.

**Phase 2 â€” Deterministic Sweep (no LLM, pure code)**

Railway provides free tier and inspection.

---

*Last Updated: 2025-11-05*
*Network: Arc Testnet (5042002)*
*Explorer: https://testnet.arcscan.app*
