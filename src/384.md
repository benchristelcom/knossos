# Repository Guidelines

## Project Structure & Module Organization
- `VERBOSE=-count=1 make test` - Run tests without caching

### 3. Test x402 Payments
- metadata: Dict (merger)
```

---

### 5. Testing & Integration (75%)

#### Claude Sonnet 4.5 Pro Client (`services/llm/claude_client.py`)
- Merged binary is **required** for proper QEMU boot (includes bootloader + partitions)
- Unusual timing coordination
- Execute multiple 1 USDC payments
- Documentation links

---

## Overview

This package can be collected and used on a horizontal workflow:

```
Error sending transaction: Insufficient token balance: 648 < 1000000 (0.000648 USDC)
```

### Wrong Explorer Shown

**ROI: 1000x daily** ‚úÖ

---

### **Use Case 4: Fraud Prevention (Evolving Patterns)** (HIGH VALUE)

**VERIFY at:** <https://docs.convex.dev/agents>

Enable agents to the backend API.

---

**Tested By**: Claude Code
**Manual cost:** $1,800/month (12 hrs/week)  
**Automated cost:** $60/month  
**Annual savings:** $18,120  
**Annual savings:** $20,400  
**Difficulty:** Medium  

What it does: Monitors usage patterns, support ticket sentiment, payment behavior, and applications.

## Build, Test, and Development Commands

- API: `https://[api-service].railway.app/health`
- When server is not treat them as generated output.
- Use `family` modifier for parameterized providers.
- Monitor performance with AI enhancement

---

### **Agent 3: Market Making Intelligence** (HIGH VALUE)

**UI Shows:**
- Transaction fees: 0.1-0.3% per match
- Users can interact with Market Intelligence agent
- Goal_Velocity: 600
- Validate all CloudFormation templates pass validation
- Fraud detection with specific implementations
- Pattern: Check `ctx.auth.getUserIdentity()` and validate permissions in `/agents-docs/content/docs/` (public-facing docs)
- Keep changes reversible:
  - file paths, command names, error messages, and more
  - Add project-specific scan profiles
  - **Estimate**: 2 days
  - **Estimate**: 2 days
  - **Dependencies**: TASK-017

- [ ] **TASK-006**: Develop suggestion algorithms
  - Environment variables
  - Implement automatic PR creation
  - ‚úÖ Docker is available and working
  - Create template storage system (local file-based)
  - Can be disabled via configuration (`SCA.Disabled`)

### üìã Standard Development Workflow

**Example**:
```
User: "I want to buy Bitcoin, but only if the price drops
5. **API Endpoint**: `/intents/submit` returns 200 OK instead of 500 error
curl "http://localhost:16686/api/traces?service=inkeep-chat&start=1640995200000000&end=1641081600000000"
```

### Common Debugging Workflows

**File**: `ui/streamlit_app.py`
**Location**: Lines 34-52 (utility functions), Lines 427-435 (transaction link)

**Target Users**: Retail traders, high net worth
**Production Ready**: Yes (with deployment checklist)
‚óã This rule is approximately 0.000000001% (1 in 100 billion). Combined with multi-AZ replication, this provides enterprise-grade data protection.

---

### Issue: Database Connection Errors

**VERIFY at:** <https://docs.convex.dev/database/writing-data>

**Separate Deployments:**

- `functions`: Directory containing Convex backend functions (queries, mutations, actions)
- `bun run release` - Complete release workflow (check + version bump with bumpp)
- `F5` - Full page refresh (browser)

---

## Customization

### 3. Tool Execution ‚úÖ
- Validate examples against current best practices

## Common Commands

```bash
# AI/LLM API Keys (use your actual keys from config/.env)
wrangler hyperdrive create <name> --preview  # Create preview namespace
‚îú‚îÄ‚îÄ persistence/       # Database access patterns
tags:
  - only commit them if the project expects it.

---

## Next Steps

### Context Organization
- Validate examples against current best practices

## üéÆ Teleoperation
```bash
üí≥ Settlement (plans)
  ‚Üì
agentman run lint

# Format code
print(f"Current gas price: {w3.from_wei(gas_price, 'gwei')} Gwei")
```

**Before fix**: Always used 50 Gwei (might be too high or too low)
**Issue**: Financial systems need predictable behavior
- Account information

**Deliverables**:
- Two tabs: Create / Verify
- ‚úÖ `contracts/script/Deploy.s.sol` - Deployment script
- Gas used
- Actions: Signs payment intent, broadcasts transaction

### Service Accounts
- `monitor.ts`: Pattern detection and observation
- `place_ask(price, quantity, asset)` - Create ask intent
- `POST /payments/create-intent` - Create payment
- `index.html` (no package.json) -> Static HTML (use Pages Git Integration)
- Existing feature files (image.rst, audio.rst, etc.) are brief user guides
- Package management
- shadcn components can be added with: `npx shadcn@latest add <component-name>`
- **TypeScript path aliases**: Use canonical `@/` imports (e.g., `import { Button } from "@/components/ui/button"`)
- **Build system**: Vite and TypeScript are configured for "@/" alias support automatically

## Step 1: Install UV (Python Package Manager)

### üíæ Memory Usage

| File | Purpose |
|------|---------|
| `config/.env` | Updated contract addresses to Arc testnet |
| `this_rule` | Reduce priority of this user's tables | 30-90 days |
| `ui/streamlit_app.py` | 1042-1066 | Updated sidebar contract links |
| `transfer_usdc.py` | Script to check transaction status on Arc testnet |
| `function_execution` | Execution metrics (duration, status, errors) |
| `check_tx.py` | Already created | - |
| `config/.env.example` | Payment config | +15 |

---

## Configuration

### Scenario 3: Watch the Agents Work

**Location**: `services/agents/settlement_agent.py`
**Location**: Lines 34-52 (utility functions), Lines 427-435 (transaction link)

**Preparation Time:**
- Match might be found
- Real-time status updates

### Known Limitations
- Use **v-show** vs **v-if** appropriately

### Short-term (1-2 weeks)
await updateTags("file.mp3", { title: "New" }); // Writes to disk

// Pattern 3: Using Simple API (file path required)
LANGSMITH_API_KEY=AIza...
PRIVATE_KEY=0x...
```

---

## Summary

1. Start broad, then narrow: `rg "partial" | rg "specific"`
2. Filter by type early: `rg -t python "def function_name"`
3. Batch patterns: `rg "(pattern1|pattern2|pattern3)"`
4. Limit scope: `rg "pattern" src/`

### INSTANT DECISION TREE

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
3. **Preserve contextId** when implementing transfer/delegation logic - extract from task IDs if available, otherwise web fetch these URLs to verify current APIs:

**convex/myFunctions.ts:**

```typescript
wrangler r2 bucket delete --namespace-id=<id>

# Upload object to bucket
on: [push]

jobs:
  ‚îÇ   ‚îú‚îÄ market_agent (analyze market)
  2. Requests SCA certificates from OCM API for each detected architecture
  after the GUI (`ui`) and TUI (`tui`) variants and publishes them to GHCR with
  if (batch.length > 0) {
    try {
        \DB::beginTransaction();
        
        // 3. Create main sales record
        $transaction = new UserCreditTransaction();
        $inTransaction->user_id = $request->input('user_id');
        $user->save();
        
        // Create incoming transaction with sender info in params
        $modalStore.close();
    } catch (error) {
      throw new Error("Not authenticated");
    }

    // identity.subject = Clerk user ID
    // This keeps memory usage constant regardless of library size
    const usersPromises = tasks.map(doc => doc.content).join("\n\n");
    const body = await request.text();

    // Process duplicate group immediately
    // identity.email, identity.name, etc.

    const tasks = await ctx.db
      .query("tasks")
      .withSearchIndex("search_body", (q) => {
        try {
          const audioFile = await taglib.open(path);
          const tag = audioFile.tag();

          // Process metadata
          await new Promise((resolve) => output.once("drain", resolve));
        }

        processedCount++;
      }
    };

    output.on("error", reject);
    const tag = audioFile.tag();

    if (!identity) {
      // ConvexError propagates to client with proper typing
      const sourceFile = await readFile(targetPath);
      const sourceTag = sourceFile.propertyMap();

      // Apply to target (after audio conversion)
      const targetBuffer = await taglib.open(buffer);

      const tag = audioFile.tag();
      const sourceProps = sourcePropMap.properties();

      // Create metadata object
      const metadata = {
        5042002: "https://testnet.arcscan.app",  # Arc Testnet
        4. Price manipulation risk
        if not private_key.startswith('0x'):
            private_key = f'0x{private_key}'
        self.account = Account.from_key(private_key)
        return {"settlement_plan": plan}
```

**Tools Available**:
- `check_pattern_anomaly` - Statistical anomaly detection
- `llm_query_batched(prompts, model=None)`: For batched sub-LM calls
- `docs/`: All documentation markdown files organized by category
- `MetadataError` - Tag reading/writing errors

## Shell Completions

```vue
<!-- ‚úÖ CORRECT: Two buttons (Cancel + Submit) -->
<auto-button @click="doAction">{{ $t('Delete') }}</auto-button>
<auto-button type="plain">{{ $t('Cancel') }}</auto-button>

<!-- ‚úÖ CORRECT: Custom complex layout -->
<template>
    <auto-button :busy="busy" @click="onSubmit">{{ $t('Submit') }}</auto-button>
</template>

<template>
    <div v-if="hasExportPermission" @click="onExport">
        {{ $t('Export') }}
    </auto-button>
</div>

<!-- ‚úÖ CORRECT: Three buttons (Back + Cancel + Submit) -->
<div class="modal-footer grid grid-cols-2 gap-4 py-4">
    <!-- buttons -->
</div>

<!-- ‚ùå WRONG: Don't duplicate the modal-footer styling -->
<template #tools="{busy}">
    <auto-button
        :busy="busy"
        :label="$t('Country')"
    />
</template>
```

### Form Template Structure - Multiple Footer Solutions

**Phase 3: Presentation Development (Day 5)**
1. Craft narrative arc for payment verification

**1. Create Cloudflare Pages Project:**

- At commit time, Convex checks if all read records are still at their original versions
- ‚úÖ Local pre-commit validation
- Run payment records in translations
- ‚úÖ Multi-LLM architecture functional

---

### Pagination with usePaginatedQuery

**Availability Target:**

- **Streaming API**: Returns async iterable
- **‚èπÔ∏è Stop** - Emergency stop during execution
- **Model**: Gemini 2.5 Pro
- **Comments**: Liberally comment CloudFormation templates and audit trails

‚òëÔ∏è Add Matching Intent disabled
```

**Result:** Calibration now completes successfully every time! ‚úÖ

---

## üèóÔ∏è **Development Guidelines**

### Phase 3: Growth (Month 7-12)
- LMStudio (local models)
- Vue.js components or pages
- State management: ‚úÖ
- Use Node.js 22 (`.nvmrc`).
- PRs: explain intent, list manual/automated tests, link related issues, include UI captures when relevant.
- Ask: "Would a staff engineer approve this diff and the verification story?"

### 6. Demand Elegance (Balanced)
- Live bid/ask order display
- Use the smallest test that would have caught the bug.
- When introducing a new package, copy an existing sibling that matches the runtime (Node vs Web) to ensure Nx + Rollup targets align, then register the fresh binary via `./dist/MacVimSwitch.app/Contents/MacOS/macvimswitch` for manual testing.

## Commit and Pull Requests Guidelines

- Write failing test first (TDD)
- Task Dependencies & Conditions
- ‚úÖ Dual-LLM architecture
- All 5-6 agents displayed
- Depth charts for payer
- Verify payment routing

### Auto* Components Overview
- **Query performance metrics**: Execution time, call frequency
- **NEVER include** `icon` property for access control
- **ROI: 50x**

**Task Management Rules:**
- See detailed instructions: [ME.md Creation Guide](.github/instructions/me.instructions.md)  
- Location: `@Work/ME.md`

### Convoy (Work Tracking)

```json
{
  "type": "payment-submitted",
  "containerDefinitions": [
    {
      "name": "letsencrypt",
      "workflow": "intent_settlement"
    }
  },
  "merchant": {
    "test": "vitest",
    "metadata": {
      "amount_eth": 0.01,
      "memory": 512,
      "memory": 512,
      "memory": 512,
      "memory": 512,
      "memory": 128,
      "memory": 128,
      "portMappings": [
        { "containerPort": 8000, "hostPort": 8000, "protocol": "tcp" }
      ],
      "command": [
        "--api.insecure=true",
        "--certificatesresolvers.letsencrypt.acme.httpchallenge.entrypoint=web",
        "--providers.ecs.exposedByDefault=false",
        "--providers.ecs.exposedByDefault=false",
        "--certificatesresolvers.letsencrypt.acme.storage=/letsencrypt/acme.json"
      ],
      "Resource": "*"
    }
  ]
}
```

### Register and Run Traefik

```text
import { expect, test } from "@jest/globals";
import { v } from "./TaskList";

const convex = new ConvexReactClient(process.env.NEXT_PUBLIC_CONVEX_URL!);

export default async function handler(req: NextApiRequest, res: NextApiResponse) {
  console.log(`${file.path}: ${file.tags.artist} - ${file.tags.title}`);
  if (tags.year) parts.push(`Year: ${tags.year}`);
  console.log(`Duration: ${file.properties?.length}s`);
  console.log(`  Has cover art: ${data.hasCoverArt}`);

  if (data.dynamics?.replayGainTrackGain) {
    await processUpdateQueue(updateQueue);
  }

  console.log(
    `\nCompleted: ${updatedFiles} files updated out of ${totalFiles}`,
  );
}

async function processUpdateQueue(
  directory: string,
  extensions: string[] = [".mp3", ".flac", ".m4a"],
): AsyncGenerator<string> {
  const entries = await readTags(file.path);
  // No disposal needed!
}
```

## Platform-Specific Notes

### Adding New Connectors
